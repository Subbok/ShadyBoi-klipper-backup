####################################
#             INCLUDES 
####################################
[include mainsail.cfg]
#[include KAMP_Settings.cfg]
[include ./CFG/macros.cfg]
[include ./CFG/led_effect.cfg]
[include ./CFG/tmc-autotune.cfg]
[include ./CFG/eddy.cfg]
#[include ./CFG/lis2dw.cfg]
#[include ./CFG/adxl345.cfg]

####################################
#          MISCELLANEOUS
####################################

[exclude_object]

[gcode_arcs]
resolution: 0.1

[firmware_retraction]
retract_length: 0.5
retract_speed: 45
unretract_extra_length: 0
unretract_speed: 20

[input_shaper]
shaper_freq_x: 59.4
shaper_type_x: ei
shaper_freq_y: 49.1
shaper_type_y: ei

####################################
#               CORE
####################################

[mcu CB1]
serial: /tmp/klipper_host_mcu

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_420049000B504B5735313920-if00
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_z_velocity: 5
max_z_accel: 100
max_accel: 5000
square_corner_velocity: 5.0

####################################
#             FANS/TEMP
####################################

[fan]
pin: CB1: gpio79

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[heater_fan hotend_fan]
pin: PA3
max_power: 1.0
fan_speed: 1
kick_start_time: 0
heater: extruder
heater_temp: 50.0

####################################
#            STEPPERS
####################################

[stepper_x]
step_pin: PC8
dir_pin: !PC9
enable_pin: !PA15
microsteps: 16
rotation_distance: 40
endstop_pin: ^PD3
position_endstop: -3
position_min: -3
position_max: 243.5
homing_speed: 80
second_homing_speed: 20

[stepper_y]
step_pin: PA10
dir_pin: !PA14
enable_pin: !PA13
microsteps: 16
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 230
homing_speed: 80
second_homing_speed: 20

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_min: -6
position_max: 215
homing_speed: 40
second_homing_speed: 1
homing_retract_dist: 2.3

[stepper_z1]
step_pin: PB12
dir_pin: PB11
enable_pin: !PA8
microsteps: 16
rotation_distance: 8

[extruder]
step_pin: PB0
dir_pin: !PB1
enable_pin: !PC4
microsteps: 16
rotation_distance: 7.651
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.048
max_extrude_cross_section: 5

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_z1]
uart_pin: PB2
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 extruder]
uart_pin: PA6
run_current: 0.800
hold_current: 0.500

####################################
#            HEATERS
####################################

[extruder]
heater_pin: PC5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA1
#control: pid
min_temp: -200
max_temp: 300
min_extrude_temp: 190

[heater_bed]
heater_pin: PA5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
#control: pid
min_temp: 0
max_temp: 130
pwm_cycle_time: 0.2

####################################
#            PROBE/MESH
####################################

[output_pin probe_enable]
pin: PC15       
value: 0

[z_tilt]
z_positions:
            237.5, 128
            67.5, 128
points:
            237.5, 128
            67.5, 128
speed: 150
horizontal_move_z: 5
retries: 20
retry_tolerance: .0001

#[probe]
#pin: ^!PC13         
#deactivate_on_each_sample: False
#x_offset: -35
#y_offset: -10.5
#z_offset: 0
#speed: 2.5
#samples: 2
#sample_retract_dist: 2.5
#samples_tolerance: 0.05
#samples_tolerance_retries: 3
#activate_gcode:
#    Probe_Deploy
#    G4 P500
#deactivate_gcode:
#    Probe_Stow

[safe_z_home]
home_xy_position: 152.5,128
speed: 150
z_hop: 5
z_hop_speed: 30

[bed_mesh]
speed: 100
horizontal_move_z: 2
mesh_min: 5,5         
mesh_max: 208.5,218     
probe_count: 15,15
mesh_pps: 2,2
fade_start: 1
fade_end: 10
fade_target: 0
algorithm: bicubic
adaptive_margin: 5

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.836
#*# pid_ki = 5.340
#*# pid_kd = 38.929
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 72.871
#*# pid_ki = 1.518
#*# pid_kd = 874.457
#*#
#*# [probe]
#*# z_offset = 0.100
#*#
#*# [bed_mesh plate]
#*# version = 1
#*# points =
#*# 	0.295629, 0.288129, 0.318129, 0.346879, 0.330629, 0.341879, 0.375629, 0.408129, 0.393129, 0.376879, 0.405629, 0.428129, 0.443129, 0.463129, 0.505629
#*# 	0.259379, 0.240629, 0.269379, 0.274379, 0.274379, 0.281879, 0.300629, 0.315629, 0.301879, 0.295629, 0.303129, 0.331879, 0.335629, 0.343129, 0.375629
#*# 	0.218129, 0.215629, 0.225629, 0.229379, 0.206879, 0.211879, 0.255629, 0.249379, 0.236879, 0.215629, 0.211879, 0.235629, 0.223129, 0.226879, 0.250629
#*# 	0.170629, 0.179379, 0.210629, 0.186879, 0.160629, 0.159379, 0.193129, 0.190629, 0.165629, 0.155629, 0.171879, 0.158129, 0.160629, 0.163129, 0.195629
#*# 	0.123129, 0.120629, 0.135629, 0.118129, 0.066879, 0.078129, 0.108129, 0.101879, 0.078129, 0.055629, 0.050629, 0.068129, 0.085629, 0.070629, 0.101879
#*# 	0.068129, 0.051879, 0.079379, 0.055629, 0.028129, 0.023129, 0.038129, 0.051879, 0.023129, 0.005629, 0.014379, 0.018129, 0.026879, 0.040629, 0.058129
#*# 	0.030629, 0.018129, 0.021879, 0.004379, -0.030621, -0.034371, -0.018121, -0.008121, -0.029371, -0.048121, -0.029371, -0.015621, -0.021871, -0.016871, 0.020629
#*# 	-0.029371, -0.041871, -0.035621, -0.049371, -0.079371, -0.093121, -0.071871, -0.069371, -0.079371, -0.084371, -0.059371, -0.059371, -0.061871, -0.044371, -0.016871
#*# 	-0.099371, -0.084371, -0.095621, -0.109371, -0.145621, -0.149371, -0.134371, -0.114371, -0.118121, -0.131871, -0.120621, -0.109371, -0.099371, -0.085621, -0.046871
#*# 	-0.171871, -0.168121, -0.151871, -0.158121, -0.183121, -0.194371, -0.156871, -0.139371, -0.161871, -0.158121, -0.125621, -0.094371, -0.089371, -0.066871, -0.016871
#*# 	-0.201871, -0.180621, -0.178121, -0.204371, -0.211871, -0.210621, -0.178121, -0.169371, -0.171871, -0.185621, -0.136871, -0.109371, -0.084371, -0.066871, -0.028121
#*# 	-0.191871, -0.189371, -0.215621, -0.211871, -0.216871, -0.218121, -0.200621, -0.186871, -0.194371, -0.191871, -0.173121, -0.149371, -0.119371, -0.086871, -0.046871
#*# 	-0.144371, -0.208121, -0.231871, -0.220621, -0.238121, -0.241871, -0.214371, -0.198121, -0.204371, -0.179371, -0.185621, -0.134371, -0.124371, -0.074371, -0.043121
#*# 	-0.178121, -0.224371, -0.238121, -0.239371, -0.268121, -0.254371, -0.210621, -0.196871, -0.171871, -0.170621, -0.133121, -0.090621, -0.055621, -0.043121, 0.031879
#*# 	-0.216871, -0.241871, -0.235621, -0.244371, -0.251871, -0.260621, -0.190621, -0.181871, -0.176871, -0.174371, -0.106871, -0.059371, -0.038121, 0.020629, 0.079379
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 5.0
#*# max_x = 205.9
#*# min_y = 5.0
#*# max_y = 217.94
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.016683, -0.012067, -0.062067, -0.098317
#*# 	0.005433, -0.033317, -0.088317, -0.154567
#*# 	0.000433, 0.017933, -0.045817, -0.514567
#*# x_count = 4
#*# y_count = 3
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 92.13
#*# max_x = 130.86
#*# min_y = 107.0
#*# max_y = 128.0
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3225745.796,0.100000:3224635.697,0.150000:3223416.706,
#*# 	0.200000:3222222.917,0.250000:3221036.172,0.300000:3219897.090,
#*# 	0.350000:3218724.016,0.400000:3217643.277,0.450000:3216567.196,
#*# 	0.500000:3215508.897,0.550000:3214489.897,0.600000:3213475.700,
#*# 	0.650000:3212461.121,0.700000:3211497.193,0.750000:3210547.485,
#*# 	0.800000:3209627.191,0.850000:3208745.373,0.900000:3207869.152,
#*# 	0.950000:3207018.823,1.000000:3206173.745,1.050000:3205353.148,
#*# 	1.100000:3204565.141,1.150000:3203784.289,1.200000:3203020.028,
#*# 	1.250000:3202240.189,1.300000:3201535.323,1.350000:3200798.053,
#*# 	1.400000:3200031.425,1.450000:3199277.570,1.500000:3198577.438,
#*# 	1.550000:3197846.878,1.600000:3197191.646,1.650000:3196523.266,
#*# 	1.700000:3195839.157,1.750000:3195198.352,1.800000:3194539.208,
#*# 	1.850000:3193896.803,1.900000:3193290.336,1.950000:3192621.768,
#*# 	2.000000:3192045.935,2.050000:3191480.260,2.100000:3190852.412,
#*# 	2.150000:3190261.792,2.200000:3189708.954,2.250000:3189136.628,
#*# 	2.300000:3188581.525,2.350000:3188061.196,2.400000:3187497.709,
#*# 	2.450000:3186918.961,2.500000:3186478.598,2.550000:3185955.904,
#*# 	2.600000:3185482.956,2.650000:3185022.523,2.700000:3184524.580,
#*# 	2.750000:3184067.695,2.800000:3183611.154,2.850000:3183149.580,
#*# 	2.900000:3182725.110,2.950000:3182277.380,3.000000:3181843.081,
#*# 	3.050000:3181463.545,3.100000:3181021.341,3.150000:3180651.321,
#*# 	3.200000:3180231.777,3.250000:3179865.345,3.300000:3179495.707,
#*# 	3.350000:3179137.191,3.400000:3178795.428,3.450000:3178430.316,
#*# 	3.500000:3178069.929,3.550000:3177740.829,3.600000:3177377.649,
#*# 	3.650000:3177056.314,3.700000:3176746.118,3.750000:3176467.014,
#*# 	3.800000:3176120.018,3.850000:3175861.490,3.900000:3175537.862,
#*# 	3.950000:3175231.900,4.000000:3174942.018,4.050000:3174668.101
#*# calibration_temp = 35.797441
