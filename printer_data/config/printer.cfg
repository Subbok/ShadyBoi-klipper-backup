####################################
#             INCLUDES 
####################################
[include mainsail.cfg]
[include KAMP_Settings.cfg]
[include ./CFG/macros.cfg]
[include ./CFG/led_effect.cfg]
[include ./CFG/tmc-autotune.cfg]
#[include ./CFG/eddy.cfg]
#[include ./CFG/lis2dw.cfg]
#[include ./CFG/adxl345.cfg]

####################################
#          MISCELLANEOUS
####################################

[exclude_object]

[gcode_arcs]
resolution: 0.1

[firmware_retraction]
retract_length: 0.5
retract_speed: 45
unretract_extra_length: 0
unretract_speed: 20

#[input_shaper]
#shaper_freq_x: 59.4
#shaper_type_x: ei
#shaper_freq_y: 49.1
#shaper_type_y: ei

####################################
#               CORE
####################################

[mcu CB1]
serial: /tmp/klipper_host_mcu

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_420049000B504B5735313920-if00
restart_method: command

[mcu eddy]
serial: /dev/serial/by-id/usb-Klipper_rp2040_45503571290C0CF8-if00

[printer]
kinematics: cartesian
max_velocity: 300
max_z_velocity: 5
max_z_accel: 100
max_accel: 5000
square_corner_velocity: 5.0

####################################
#             FANS/TEMP
####################################

[fan]
pin: CB1: gpio79

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[heater_fan hotend_fan]
pin: PA3
max_power: 1.0
fan_speed: 1
kick_start_time: 0
heater: extruder
heater_temp: 50.0

####################################
#            STEPPERS
####################################

[stepper_x]
step_pin: PC8
dir_pin: !PC9
enable_pin: !PA15
microsteps: 16
rotation_distance: 40
endstop_pin: ^PD3
position_endstop: -3
position_min: -3
position_max: 243.5
homing_speed: 80
second_homing_speed: 20

[stepper_y]
step_pin: PA10
dir_pin: !PA14
enable_pin: !PA13
microsteps: 16
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 230
homing_speed: 80
second_homing_speed: 20

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_min: -6
position_max: 215
homing_speed: 60
second_homing_speed: 1
homing_retract_dist: 2.3

[stepper_z1]
step_pin: PB12
dir_pin: PB11
enable_pin: !PA8
microsteps: 16
rotation_distance: 8

[extruder]
step_pin: PB0
dir_pin: !PB1
enable_pin: !PC4
microsteps: 16
rotation_distance: 7.651
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.048
max_extrude_cross_section: 5

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_z1]
uart_pin: PB2
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 extruder]
uart_pin: PA6
run_current: 0.800
hold_current: 0.500

####################################
#            HEATERS
####################################

[extruder]
heater_pin: PC5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA1
#control: pid
min_temp: -200
max_temp: 300
min_extrude_temp: 190

[heater_bed]
heater_pin: PA5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
#control: pid
min_temp: 0
max_temp: 130
pwm_cycle_time: 0.2

####################################
#            PROBE/MESH
####################################

[temperature_sensor btt_eddy_mcu]
sensor_type: temperature_mcu
sensor_mcu: eddy
min_temp: 10
max_temp: 100

[probe_eddy_current btt_eddy]
sensor_type: ldc1612
#i2c_address:
i2c_mcu: eddy
i2c_bus: i2c0f
z_offset: 1.0
speed: 25
sample_retract_dist: 2.5
samples: 3
samples_tolerance: 0.05
samples_tolerance_retries: 3
x_offset: -37.5
y_offset: -7.5
data_rate: 500

[temperature_probe btt_eddy]
sensor_type: Generic 3950
sensor_pin: eddy:gpio26
speed: 200
horizontal_move_z: 1

[safe_z_home]
home_xy_position: 155,125
speed: 150
z_hop: 10
z_hop_speed: 25

[bed_mesh]
speed: 150
horizontal_move_z: 2
mesh_min: 20,10    
mesh_max: 206,200     
probe_count: 11
mesh_pps: 2,2
fade_start: 1
fade_end: 10
fade_target: 0
algorithm: bicubic
adaptive_margin: 5

[z_tilt]
z_positions:
            196, 122.5
            57.5, 122.5
points:
            196, 122.5
            57.5, 122.5
speed: 200
horizontal_move_z: 5
retries: 20
retry_tolerance: .0015

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.836
#*# pid_ki = 5.340
#*# pid_kd = 38.929
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 72.871
#*# pid_ki = 1.518
#*# pid_kd = 874.457
#*#
#*# [probe]
#*# z_offset = 0.100
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3198919.842,0.100000:3198301.503,0.150000:3197648.339,
#*# 	0.200000:3196948.257,0.250000:3196288.334,0.300000:3195599.256,
#*# 	0.350000:3194953.789,0.400000:3194302.364,0.450000:3193652.957,
#*# 	0.500000:3193022.804,0.550000:3192427.616,0.600000:3191803.957,
#*# 	0.650000:3191218.174,0.700000:3190629.828,0.750000:3190035.045,
#*# 	0.800000:3189505.868,0.850000:3188946.895,0.900000:3188394.576,
#*# 	0.950000:3187873.285,1.000000:3187353.306,1.050000:3186819.263,
#*# 	1.100000:3186311.024,1.150000:3185822.123,1.200000:3185333.466,
#*# 	1.250000:3184852.840,1.300000:3184391.731,1.350000:3183959.201,
#*# 	1.400000:3183498.668,1.450000:3183032.065,1.500000:3182635.991,
#*# 	1.550000:3182204.157,1.600000:3181786.015,1.650000:3181371.082,
#*# 	1.700000:3180979.797,1.750000:3180594.953,1.800000:3180209.963,
#*# 	1.850000:3179817.317,1.900000:3179482.485,1.950000:3179114.808,
#*# 	2.000000:3178762.952,2.050000:3178399.542,2.100000:3178047.289,
#*# 	2.150000:3177734.710,2.200000:3177369.162,2.250000:3177063.619,
#*# 	2.300000:3176761.150,2.350000:3176471.034,2.400000:3176151.732,
#*# 	2.450000:3175842.874,2.500000:3175550.814,2.550000:3175262.789,
#*# 	2.600000:3174980.459,2.650000:3174773.142,2.700000:3174446.057,
#*# 	2.750000:3174187.034,2.800000:3173911.560,2.850000:3173667.734,
#*# 	2.900000:3173385.420,2.950000:3173128.174,3.000000:3172933.590,
#*# 	3.050000:3172683.585,3.100000:3172452.809,3.150000:3172207.314,
#*# 	3.200000:3171983.291,3.250000:3171773.762,3.300000:3171531.186,
#*# 	3.350000:3171335.239,3.400000:3171124.067,3.450000:3170920.127,
#*# 	3.500000:3170693.403,3.550000:3170505.787,3.600000:3170294.201,
#*# 	3.650000:3170126.594,3.700000:3169956.255,3.750000:3169779.025,
#*# 	3.800000:3169578.451,3.850000:3169405.345,3.900000:3169225.651,
#*# 	3.950000:3169073.018,4.000000:3168910.492,4.050000:3168742.912
#*# calibration_temp = 35.102700
