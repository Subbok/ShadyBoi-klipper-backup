####################################
#             INCLUDES 
####################################
[include mainsail.cfg]
[include KAMP_Settings.cfg]
[include ./CFG/macros.cfg]
[include ./CFG/led_effect.cfg]
[include ./CFG/tmc-autotune.cfg]
#[include ./CFG/lis2dw.cfg]
#[include ./CFG/adxl345.cfg]

####################################
#          MISCELLANEOUS
####################################

[exclude_object]

[gcode_arcs]
resolution: 0.1

[firmware_retraction]
retract_length: 0.5
retract_speed: 45
unretract_extra_length: 0
unretract_speed: 20

#[input_shaper]
#shaper_freq_x: 59.4
#shaper_type_x: ei
#shaper_freq_y: 49.1
#shaper_type_y: ei

####################################
#               CORE
####################################

[mcu CB1]
serial: /tmp/klipper_host_mcu

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_420049000B504B5735313920-if00
restart_method: command

[mcu eddy]
serial: /dev/serial/by-id/usb-Klipper_rp2040_45503571290C0CF8-if00

[printer]
kinematics: cartesian
max_velocity: 300
max_z_velocity: 5
max_z_accel: 100
max_accel: 5000
square_corner_velocity: 5.0

####################################
#             FANS/TEMP
####################################

[fan]
pin: CB1: gpio79

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[heater_fan hotend_fan]
pin: PA3
max_power: 1.0
fan_speed: 1
kick_start_time: 0
heater: extruder
heater_temp: 50.0

####################################
#            STEPPERS
####################################

[stepper_x]
step_pin: PC8
dir_pin: !PC9
enable_pin: !PA15
microsteps: 16
rotation_distance: 40
endstop_pin: ^PD3
position_endstop: -3
position_min: -3
position_max: 243.5
homing_speed: 80
second_homing_speed: 20

[stepper_y]
step_pin: PA10
dir_pin: !PA14
enable_pin: !PA13
microsteps: 16
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 230
homing_speed: 80
second_homing_speed: 20

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_min: -6
position_max: 215
homing_speed: 60
second_homing_speed: 1
homing_retract_dist: 2.3

[stepper_z1]
step_pin: PB12
dir_pin: PB11
enable_pin: !PA8
microsteps: 16
rotation_distance: 8

[extruder]
step_pin: PB0
dir_pin: !PB1
enable_pin: !PC4
microsteps: 16
rotation_distance: 7.651
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.048
max_extrude_cross_section: 5

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 stepper_z1]
uart_pin: PB2
run_current: 0.650
hold_current: 0.500
interpolate: true

[tmc2209 extruder]
uart_pin: PA6
run_current: 0.800
hold_current: 0.500

####################################
#            HEATERS
####################################

[extruder]
heater_pin: PC5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA1
#control: pid
min_temp: -200
max_temp: 300
min_extrude_temp: 190

[heater_bed]
heater_pin: PA5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
#control: pid
min_temp: 0
max_temp: 130
pwm_cycle_time: 0.2

####################################
#            PROBE/MESH
####################################

[temperature_sensor btt_eddy_mcu]
sensor_type: temperature_mcu
sensor_mcu: eddy
min_temp: 10
max_temp: 100

[probe_eddy_current btt_eddy]
sensor_type: ldc1612
i2c_mcu: eddy
i2c_bus: i2c0f
speed: 10
samples: 3
samples_tolerance: 0.01
samples_tolerance_retries: 3
x_offset: -37.5
y_offset: -7.5
data_rate: 500

[temperature_probe btt_eddy]
sensor_type: Generic 3950
sensor_pin: eddy:gpio26
speed: 200
horizontal_move_z: 1

[safe_z_home]
home_xy_position: 155,125
speed: 150
z_hop: 10
z_hop_speed: 25

[bed_mesh]
speed: 200
horizontal_move_z: 2
mesh_min: 10,10    
mesh_max: 200,200     
probe_count: 15
mesh_pps: 2,2
fade_start: 1
fade_end: 10
fade_target: 0
algorithm: bicubic
adaptive_margin: 5

[z_tilt]
z_positions:
            236, 122.5
            55, 122.5
points:
            236, 122.5
            55, 122.5
speed: 200
horizontal_move_z: 2
retries: 20
retry_tolerance: .002

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.836
#*# pid_ki = 5.340
#*# pid_kd = 38.929
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 72.871
#*# pid_ki = 1.518
#*# pid_kd = 874.457
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3210752.351,0.100000:3210529.584,0.150000:3210248.548,
#*# 	0.200000:3209598.916,0.250000:3208711.090,0.300000:3207868.047,
#*# 	0.350000:3207010.657,0.400000:3206217.981,0.450000:3205396.008,
#*# 	0.500000:3204605.367,0.550000:3203782.084,0.600000:3203035.238,
#*# 	0.650000:3202212.851,0.700000:3201442.473,0.750000:3200673.829,
#*# 	0.800000:3199888.252,0.850000:3199162.125,0.900000:3198443.720,
#*# 	0.950000:3197746.299,1.000000:3197105.192,1.050000:3196394.941,
#*# 	1.100000:3195731.632,1.150000:3195064.602,1.200000:3194453.103,
#*# 	1.250000:3193785.626,1.300000:3193163.719,1.350000:3192561.110,
#*# 	1.400000:3191951.560,1.450000:3191334.186,1.500000:3190753.154,
#*# 	1.550000:3190164.461,1.600000:3189621.381,1.650000:3189044.240,
#*# 	1.700000:3188492.230,1.750000:3187963.162,1.800000:3187453.869,
#*# 	1.850000:3186891.037,1.900000:3186409.904,1.950000:3185906.406,
#*# 	2.000000:3185410.567,2.050000:3184918.666,2.100000:3184414.854,
#*# 	2.150000:3184003.430,2.200000:3183515.970,2.250000:3183076.800,
#*# 	2.300000:3182635.068,2.350000:3182202.062,2.400000:3181817.773,
#*# 	2.450000:3181388.228,2.500000:3180968.942,2.550000:3180598.347,
#*# 	2.600000:3180189.096,2.650000:3179811.040,2.700000:3179435.637,
#*# 	2.750000:3179097.970,2.800000:3178734.381,2.850000:3178371.168,
#*# 	2.900000:3178024.493,2.950000:3177679.791,3.000000:3177346.941,
#*# 	3.050000:3177037.393,3.100000:3176715.795,3.150000:3176425.498,
#*# 	3.200000:3176105.122,3.250000:3175799.952,3.300000:3175502.516,
#*# 	3.350000:3175219.903,3.400000:3174892.706,3.450000:3174675.552,
#*# 	3.500000:3174390.777,3.550000:3174141.335,3.600000:3173871.543,
#*# 	3.650000:3173617.362,3.700000:3173362.504,3.750000:3173125.552,
#*# 	3.800000:3172870.652,3.850000:3172634.404,3.900000:3172399.306,
#*# 	3.950000:3172180.524,4.000000:3171952.624,4.050000:3171726.374
#*# calibration_temp = 32.729164
#*# z_offset = 0.330
#*# drift_calibration =
#*# 	3228657.430090, -843.403755, 6.279416
#*# 	3215461.884773, -626.674511, 4.423013
#*# 	3204551.437223, -456.535358, 3.022862
#*# 	3195671.541019, -324.915421, 1.941753
#*# 	3188452.479772, -221.804306, 1.119491
#*# 	3182758.202035, -141.229311, 0.429313
#*# 	3178544.290890, -98.242058, 0.138389
#*# 	3174992.426458, -58.219417, -0.168605
#*# 	3172208.074189, -30.692966, -0.377606
#*# drift_calibration_min_temp = 34.13560295101278
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.018838, 0.020568, 0.060795, 0.068662, 0.037449, -0.025585, 0.005735, 0.036526, 0.017186, 0.036299, 0.036793, 0.037117, 0.098086, 0.125229, 0.147420
#*# 	  -0.034546, -0.007579, 0.018274, 0.037602, 0.010594, -0.036192, -0.013310, 0.022121, -0.002400, 0.010908, -0.007672, 0.006466, 0.058892, 0.100494, 0.114186
#*# 	  -0.034548, 0.004703, 0.042663, 0.040515, 0.006207, -0.038862, -0.027038, -0.012987, -0.028222, -0.030874, -0.058454, -0.034566, 0.002148, 0.042680, 0.059937
#*# 	  -0.051914, -0.024485, -0.001533, 0.018804, -0.008952, -0.040609, -0.014135, -0.024862, -0.028682, -0.027075, -0.050045, -0.043129, 0.000609, 0.030330, 0.048334
#*# 	  -0.071749, -0.024054, 0.025435, 0.014776, -0.012192, -0.049107, -0.037964, -0.040228, -0.046917, -0.052790, -0.052657, -0.054087, -0.011624, 0.036901, 0.029586
#*# 	  -0.088893, -0.061173, -0.014243, -0.002054, -0.030697, -0.050465, -0.027642, -0.041718, -0.036415, -0.060683, -0.050016, -0.052656, -0.014754, 0.042050, 0.031960
#*# 	  -0.091198, -0.045030, -0.010184, -0.004870, -0.031760, -0.062300, -0.077267, -0.053782, -0.061197, -0.053917, -0.049458, -0.063524, -0.029405, 0.015141, 0.010890
#*# 	  -0.091902, -0.061616, -0.019237, -0.005238, -0.030434, -0.047504, -0.067579, -0.057374, -0.062475, -0.057663, -0.059325, -0.094535, -0.035903, -0.008703, -0.023975
#*# 	  -0.078318, -0.021195, 0.006740, 0.011304, -0.013549, -0.066292, -0.078536, -0.077435, -0.076426, -0.059738, -0.070335, -0.094952, -0.051913, -0.022811, -0.027173
#*# 	  -0.096557, -0.053577, -0.017374, 0.008019, -0.016300, -0.052415, -0.047714, -0.045466, -0.052303, -0.029678, -0.048983, -0.066235, -0.004405, 0.014007, 0.008393
#*# 	  -0.088062, -0.053898, 0.012835, 0.018440, -0.004559, -0.046535, -0.066410, -0.054035, -0.043187, -0.034283, -0.052923, -0.062177, -0.010630, 0.025628, 0.033421
#*# 	  -0.094000, -0.063187, 0.010131, 0.026863, -0.001005, -0.028806, -0.048952, -0.030840, -0.015535, -0.023782, -0.033281, -0.042744, 0.007181, 0.056695, 0.038562
#*# 	  -0.056747, -0.015284, 0.040443, 0.038913, 0.020353, -0.041798, -0.035850, -0.025668, -0.027652, -0.013640, -0.039522, -0.039568, 0.011649, 0.036739, 0.029497
#*# 	  -0.016058, -0.005466, 0.054381, 0.056487, 0.034214, -0.001563, -0.001534, 0.015326, 0.011269, 0.023380, -0.000226, -0.000068, 0.050727, 0.076941, 0.065040
#*# 	  0.015399, 0.052775, 0.088597, 0.103453, 0.067774, 0.030469, 0.046848, 0.041811, 0.042936, 0.061923, 0.036841, 0.044237, 0.106282, 0.125538, 0.128085
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 199.97
#*# min_y = 10.0
#*# max_y = 199.97
